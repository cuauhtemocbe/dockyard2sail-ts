#!/bin/sh

echo "ğŸš€ Running pre-push validation..."

# Check if pushing to main or develop branch
protected_branch='main|develop'
current_branch=$(git rev-parse --abbrev-ref HEAD)

if echo "$current_branch" | grep -qE "^($protected_branch)$"; then
    echo "ğŸ›¡ï¸  Pushing to protected branch: $current_branch"
    
    # Run full validation
    if ! ./scripts/validate.sh; then
        echo "âŒ Pre-push validation failed"
        exit 1
    fi
    
    echo "âœ… Pre-push validation passed"
else
    echo "ğŸ“ Pushing to feature branch: $current_branch (basic checks only)"
    
    # Run basic type checking for feature branches
    if ! pnpm run typecheck; then
        echo "âŒ TypeScript type checking failed"
        exit 1
    fi
    
    echo "âœ… Basic pre-push validation passed"
fi
